---
import CopyButton from "../components/CopyButton.astro";
import background from "../assets/background.svg";
---

<div id="container">
	<img
		class="fixed top-0 left-0 w-full h-full -z-10 blur-[100px]"
		src={background.src}
		alt=""
		fetchpriority="high"
	/>
	<main>
		<section id="hero">
			<div class="mx-auto px-2 max-w-3xl py-32 lg:py-36">
				<div class="mb-8 flex">
					<div
						class="relative rounded-full px-3 py-1 text-sm/6 text-gray-600 ring-1 ring-gray-900/10 hover:ring-gray-900/20"
					>
						<a href="#" class="font-semibold text-indigo-600">
							<span class="absolute inset-0" aria-hidden="true"
							></span>
							Github
							<span aria-hidden="true">&rarr;</span></a
						>
					</div>
				</div>
				<div>
					<div id="mask1">
						<!-- back-element -->
						<div
							class="flex flex-col-reverse sm:flex-row bg-pink-100"
						>
							<h1
								class="text-8xl font-anton font-semibold text-balance uppercase text-secondary sm:text-9xl"
							>
								Mouse <span class="text-8xl">ISCOOL</span>
							</h1>
							<img
								src="/images/teddy-bear.png"
								alt="Teddy Bear"
								class="hidden sm:flex aspect-square w-[240px] h-[240px]"
							/>
						</div>
						<!-- front-element -->
						<div
							class="flex flex-col-reverse sm:flex-row"
						>
							<h1
								class="text-8xl font-anton font-semibold text-balance uppercase text-primary sm:text-9xl"
							>
								Mouse <span class="text-8xl">Reveal</span>
							</h1>
							<img
								src="/images/gift.png"
								alt="Gift"
								class="hidden sm:flex aspect-square w-[240px] h-[240px]"
							/>
						</div>
					</div>

					<p
						class="mt-8 text-lg text-balance font-medium text-gray-500 sm:text-xl/8"
					>
						Lightweight JavaScript library for creating dynamic
						masking effects based on mouse movement.
					</p>
					<div class="mt-10 flex gap-x-6">
						<code
							data-code-block=""
							class="px-4 py-2 bg-astro-dark-900/55 rounded-xl border-2 border-transparent"
						>
							<div class="group h-full flex items-center">
								<svg
									width="22"
									height="13"
									viewBox="0 0 22 13"
									fill="none"
									xmlns="http://www.w3.org/2000/svg"
									class="mr-2 relative block w-3 -rotate-90 text-astro-gray-200"
									aria-hidden="true"
									><path
										d="M1 1L11 11L21 1"
										stroke="currentColor"
										stroke-width="2"></path></svg
								>
								<div
									data-code=""
									class="flex-1 font-mono font-light text-sm text-astro-gray-200 mr-2"
								>
									npm install mouse-reveal
								</div>
								<div class="relative">
									<CopyButton />
								</div>
							</div>
						</code>
					</div>
				</div>
			</div>
		</section>
	</main>
</div>

<script>
	const MOUSE_REVEAL_CONFIG = {
		maxSize: 240,
		minSize: 0,
		background: '#000',
	};

	class MouseReveal {
		constructor(element, config = {}) {
			this.mask = document.querySelector(element);

			if (!this.mask) {
				console.error(
					"Mask element not found for the provided selector: ",
					element,
				);
				return;
			}
			this.id = this.mask.id;

			this.back = this.mask.firstElementChild; // contain the mask image
			this.front = this.mask.lastElementChild; // contain the content

			this.maxSize = config.maxSize ?? MOUSE_REVEAL_CONFIG.maxSize;
			this.minSize = config.minSize ?? MOUSE_REVEAL_CONFIG.minSize;

			// set the css variables
			document.documentElement.style.setProperty(
				`--mask-${this.id}-size`,
				`0px`,
			);
			document.documentElement.style.setProperty(
				`--mask-${this.id}-x`,
				"0px",
			);
			document.documentElement.style.setProperty(
				`--mask-${this.id}-y`,
				"0px",
			);

			// set the styles
			this.mask.style.position = "relative";
			this.back.style.background = config.background ?? MOUSE_REVEAL_CONFIG.background;
			this.front.style.position = "relative";
			this.front.style.zIndex = "-20";
			this.back.style.position = "absolute";
			this.back.style.left = "0";
			this.back.style.top = "0";
			this.back.style.zIndex = "10";
			this.back.style.maskImage =
				"url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgZmlsbD0ibm9uZSI+CjxjaXJjbGUgY3g9IjUwIiBjeT0iNTAiIHI9IjUwIiBmaWxsPSJibGFjayIvPgo8L3N2Zz4=')";
			this.back.style.maskRepeat = "no-repeat";
			this.back.style.maskSize = `var(--mask-${this.id}-size), contain`;
			this.back.style.maskOrigin = "content-box";
			this.back.style.maskPosition = `calc(var(--mask-${this.id}-x) - var(--mask-${this.id}-size)/2) calc(var(--mask-${this.id}-y) - var(--mask-${this.id}-size)/2), center`;

			this.back.style.width = `${this.front.offsetWidth}px`;
			this.back.style.height = `${this.front.offsetHeight}px`;

			this.setupListeners();
		}

		setupListeners() {
			this.back.addEventListener("mousemove", (e) => {
				this.updateMaskPosition(e);
			});

			// window.addEventListener('scroll', () => {
			//   this.updateMaskPosition(); // but does not work
			// });

			this.back.addEventListener("mouseenter", () =>
				this.animateMaskSize(
					this.minSize ?? MOUSE_REVEAL_CONFIG.minSize,
					this.maxSize ?? MOUSE_REVEAL_CONFIG.maxSize,
				),
			);

			this.back.addEventListener("mouseleave", () =>
				this.animateMaskSize(
					this.maxSize ?? MOUSE_REVEAL_CONFIG.maxSize,
					this.minSize ?? MOUSE_REVEAL_CONFIG.minSize,
				),
			);
		}

		updateMaskPosition(e) {
			var maskPosition = this.back.getBoundingClientRect();
			const absX = e.clientX - maskPosition.left; // + window.scrollX;
			const absY = e.clientY - maskPosition.top; // + window.scrollY;
			document.documentElement.style.setProperty(
				`--mask-${this.id}-x`,
				`${absX}px`,
			);
			document.documentElement.style.setProperty(
				`--mask-${this.id}-y`,
				`${absY}px`,
			);
		}

		animateMaskSize(startSize, endSize) {
			const currentSize =
				parseFloat(
					getComputedStyle(document.documentElement).getPropertyValue(
						`--mask-${this.id}-size`,
					),
				) || startSize;
			const duration = 200;
			const start = performance.now();

			const animate = (time) => {
				let progress = (time - start) / duration;
				if (progress > 1) progress = 1;

				const currentMaskSize =
					currentSize + (endSize - currentSize) * progress;
				document.documentElement.style.setProperty(
					`--mask-${this.id}-size`,
					`${currentMaskSize}px`,
				);

				if (progress < 1) {
					requestAnimationFrame(animate);
				}
			};

			requestAnimationFrame(animate);
		}
	}

	if (typeof module !== "undefined" && module.exports) {
		module.exports = MouseReveal;
	} else {
		window.MouseReveal = MouseReveal;
	}

	new MouseReveal("#mask1", {
		maxSize: 240,
		minSize: 0,
		background: "#fce7f3",
	});
</script>

<style>
	code {
		background:
			linear-gradient(66.77deg, #f3cddd 0%, #f5cee7 100%) padding-box,
			linear-gradient(155deg, #d83333 0%, #f041ff 18%, #f5cee7 45%)
				border-box;
	}
</style>
